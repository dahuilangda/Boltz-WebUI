# ğŸ§¬ De Novo å¤šè‚½/ç³–è‚½è®¾è®¡å™¨

ä¸€æ¬¾ç”¨äºå¤šè‚½ä¸ç³–è‚½ä»å¤´è®¾è®¡ (`de novo design`) çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸“ä¸ºç§‘ç ”äººå‘˜è®¾è®¡ã€‚è¯¥å·¥å…·é€šè¿‡è°ƒç”¨æœ¬åœ°éƒ¨ç½²çš„ `Boltz-WebUI` é¢„æµ‹æœåŠ¡ä½œä¸ºè®¡ç®—åç«¯ï¼Œåœ¨åºåˆ—ç©ºé—´ä¸­è¿›è¡Œæ¢ç´¢ï¼Œä»¥å‘ç°å…·æœ‰é«˜ç»“åˆæ½œåŠ›çš„æ–°åˆ†å­ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ”¬ åŸºç¡€åŠŸèƒ½
- **ç”Ÿç‰©å­¦çº¦æŸ**: è®¾è®¡ç³–è‚½æ—¶ï¼Œå·¥å…·ä¼šè‡ªåŠ¨éªŒè¯å¹¶ç¡®ä¿ç³–åŸºè¿æ¥åˆ°åŒ–å­¦ä¸Šå…¼å®¹çš„æ°¨åŸºé…¸æ®‹åŸºä¸Šï¼ˆä¾‹å¦‚ï¼ŒN-è¿é”èšç³–è¿æ¥åˆ°å¤©å†¬é…°èƒº'N'ï¼‰ã€‚
- **pLDDTæŒ‡å¯¼çš„çªå˜**: æ¼”åŒ–è¿‡ç¨‹ä¼˜å…ˆåœ¨ç»“æ„é¢„æµ‹ç½®ä¿¡åº¦è¾ƒä½ (pLDDTåˆ†æ•°ä½) çš„åŒºåŸŸå¼•å…¥çªå˜ï¼Œä»¥é«˜æ•ˆæ¢ç´¢æ„è±¡ç©ºé—´ã€‚
- **å¹¶è¡Œè¯„ä¼°**: åœ¨æ¯ä¸ªæ¼”åŒ–ä»£æ•°ä¸­ï¼Œé€šè¿‡å¤šçº¿ç¨‹å¹¶è¡Œæäº¤å’Œè¯„ä¼°å¤šä¸ªå€™é€‰åºåˆ—ï¼Œæ˜¾è‘—åŠ å¿«è®¾è®¡å‘¨æœŸã€‚

### ğŸš€ å¢å¼ºç‰ˆåŠŸèƒ½
- **è‡ªé€‚åº”çªå˜ç­–ç•¥**: 5ç§æ™ºèƒ½çªå˜ç­–ç•¥è‡ªåŠ¨é€‰æ‹©å’Œå­¦ä¹ 
  - ä¿å®ˆçªå˜ï¼šåŸºäºBLOSUM62çŸ©é˜µçš„é«˜åˆ†æ›¿æ¢
  - æ¿€è¿›çªå˜ï¼šå¤§èŒƒå›´åºåˆ—ç©ºé—´æ¢ç´¢  
  - Motifå¯¼å¼•ï¼šåŸºäºæœ‰ç›Šæ¨¡å¼çš„å®šå‘çªå˜
  - èƒ½é‡å¯¼å¼•ï¼šåŸºäºèƒ½é‡æ™¯è§‚çš„æ¸©åº¦æ§åˆ¶
  - å¤šæ ·æ€§é©±åŠ¨ï¼šé˜²æ­¢ç¾¤ä½“è¿‡åº¦æ”¶æ•›
- **Paretoå¤šç›®æ ‡ä¼˜åŒ–**: åŒæ—¶ä¼˜åŒ–ipTMå’ŒpLDDTï¼Œé¿å…å•ä¸€ç›®æ ‡åå‘
- **æ™ºèƒ½æ”¶æ•›æ£€æµ‹**: è‡ªåŠ¨æ—©åœæœºåˆ¶ï¼Œé˜²æ­¢è¿‡åº¦è®­ç»ƒå’Œèµ„æºæµªè´¹
- **åºåˆ—æ¨¡å¼å­¦ä¹ **: ä½ç½®ç‰¹å¼‚æ€§åå¥½å­¦ä¹ å’Œmotifè‡ªåŠ¨å‘ç°
- **ç¾¤ä½“å¤šæ ·æ€§ç»´æŠ¤**: å®æ—¶ç›‘æµ‹å’Œè°ƒæ•´æ¢ç´¢ç­–ç•¥


## ğŸ”§ ç¯å¢ƒå‡†å¤‡

1.  **Boltz-WebUI æœåŠ¡**: ç¡®ä¿ `Boltz-WebUI` å¹³å°æ­£åœ¨æœ¬åœ°è¿è¡Œä¸”ç½‘ç»œå¯è®¿é—®ã€‚
2.  **Python ä¾èµ–**: å®‰è£…æ‰€éœ€çš„ Python åº“ã€‚
    ```bash
    pip install requests pyyaml numpy
    ```

## ğŸš€ ä½¿ç”¨æŒ‡å—

é€šè¿‡åœ¨ç»ˆç«¯è¿è¡Œ `run_design.py` è„šæœ¬æ¥å¯åŠ¨è®¾è®¡æµç¨‹ã€‚

### æ­¥éª¤ 1: å‡†å¤‡æ¨¡æ¿YAMLæ–‡ä»¶

åˆ›å»ºä¸€ä¸ªYAMLæ–‡ä»¶ï¼Œç”¨äºæè¿°ç³»ç»Ÿä¸­é™æ€ä¸å˜çš„éƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼Œå—ä½“è›‹ç™½ï¼‰ã€‚å¾…è®¾è®¡çš„é“¾ï¼ˆbinderï¼‰ä¸åº”åŒ…å«åœ¨æ­¤æ¨¡æ¿ä¸­ï¼Œè„šæœ¬ä¼šä¾æ®å‘½ä»¤è¡Œå‚æ•°åŠ¨æ€ç”Ÿæˆã€‚

#### **ç¤ºä¾‹ 1: æ ‡å‡†è›‹ç™½Binderè®¾è®¡**

æ¨¡æ¿åº”åŒ…å«é™¤å¾…è®¾è®¡é“¾ä¹‹å¤–çš„æ‰€æœ‰é“¾ã€‚

**`template_protein.yaml`:**

```yaml
version: 1
sequences:
- protein:
    id: A
    # æ­¤å¤„å¡«å†™é¶è›‹ç™½çš„å®Œæ•´åºåˆ—
    sequence: MTEYKLVVVGAGGVGKSALTVQFVQGIFVEYDPTHFESTEKT.... 
    msa: empty
# æ³¨æ„: å¾…è®¾è®¡çš„é“¾ï¼ˆä¾‹å¦‚ B é“¾ï¼‰å°†ç”±è„šæœ¬è‡ªåŠ¨æ·»åŠ ã€‚
```

#### **ç¤ºä¾‹ 2: ç³–è‚½è®¾è®¡**

å¯¹äºç³–è‚½è®¾è®¡ï¼Œæ¨¡æ¿åªåŒ…å«å—ä½“è›‹ç™½ã€‚

**`template_glycopeptide.yaml`:**

```yaml
version: 1
sequences:
- protein:
    id: A
    # é¶ç‚¹å—ä½“è›‹ç™½çš„å®Œæ•´åºåˆ—
    sequence: MTEYKLVVVGAGGVGKSALTVQFVQGIFVEYDPTHFESTEKT....
    msa: empty
# è„šæœ¬å°†æ ¹æ®å‘½ä»¤è¡Œå‚æ•°è‡ªåŠ¨æ·»åŠ è‚½é“¾ã€èšç³–ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…±ä»·é”®ã€‚
```

### æ­¥éª¤ 2: è®¾ç½®APIä»¤ç‰Œ

å»ºè®®å°†APIå¯†é’¥è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚

```bash
# Linux / macOS
export API_SECRET_TOKEN='your-super-secret-and-long-token'

# Windows (Command Prompt)
set API_SECRET_TOKEN="your-super-secret-and-long-token"
```

ä¹Ÿå¯ä»¥é€šè¿‡ `--api_token` å‚æ•°ç›´æ¥æä¾›ã€‚

### æ­¥éª¤ 3: è¿è¡Œè®¾è®¡è„šæœ¬

ä»¥ä¸‹ä¸ºè¿è¡Œè„šæœ¬çš„å‘½ä»¤ç¤ºä¾‹ã€‚

#### **å‘½ä»¤ç¤ºä¾‹ 1: åŸºç¡€è®¾è®¡ï¼ˆè‡ªåŠ¨ä½¿ç”¨å¢å¼ºåŠŸèƒ½ï¼‰**

```bash
python run_design.py \
    --yaml_template /path/to/your/template_protein.yaml \
    --binder_chain "B" \
    --binder_length 100 \
    --iterations 50 \
    --population_size 16 \
    --num_elites 4 \
    --weight-iptm 0.6 \
    --weight-plddt 0.4 \
    --output_csv "binder_design_run_summary.csv"
```

#### **å‘½ä»¤ç¤ºä¾‹ 2: å¹³ç¨³ä¼˜åŒ–æ¨¡å¼ï¼ˆæ¨èï¼‰**

é€‚ç”¨äºéœ€è¦ç¨³å®šæ¢ç´¢çš„åœºæ™¯ï¼Œå‡å°‘è¿‡åº¦æ³¢åŠ¨ï¼š

```bash
python run_design.py \
    --yaml_template /path/to/your/template_protein.yaml \
    --binder_chain "B" \
    --binder_length 12 \
    --initial_binder_sequence "GGLVYEWQRWAG" \
    --iterations 20 \
    --population_size 16 \
    --num_elites 4 \
    --convergence-window 5 \
    --convergence-threshold 0.001 \
    --max-stagnation 3 \
    --initial-temperature 1.0 \
    --output_csv "binder_optimization_stable.csv"
```

#### **å‘½ä»¤ç¤ºä¾‹ 3: æ¿€è¿›æ¢ç´¢æ¨¡å¼**

é€‚ç”¨äºéœ€è¦å¿«é€Ÿçªç ´å±€éƒ¨æœ€ä¼˜çš„åœºæ™¯ï¼š

```bash
python run_design.py \
    --yaml_template /path/to/your/template_protein.yaml \
    --binder_chain "B" \
    --binder_length 15 \
    --iterations 30 \
    --population_size 12 \
    --num_elites 2 \
    --convergence-window 3 \
    --max-stagnation 2 \
    --initial-temperature 2.0 \
    --min-temperature 0.2 \
    --output_csv "aggressive_design_run.csv"
```

#### **å‘½ä»¤ç¤ºä¾‹ 4: ç³–è‚½è®¾è®¡ï¼ˆå¢å¼ºç‰ˆï¼‰**

æ­¤ç¤ºä¾‹è®¾è®¡ä¸€ä¸ªé•¿åº¦ä¸º15ä¸ªæ®‹åŸºçš„è‚½ï¼Œå¹¶åœ¨å…¶ç¬¬3ä¸ªä½ç½®è¿æ¥ä¸€ä¸ªç”˜éœ²ç³–ï¼ˆ'MAN'ï¼‰ï¼š

```bash
python run_design.py \
    --yaml_template /path/to/your/template_glycopeptide.yaml \
    --binder_chain "B" \
    --binder_length 15 \
    --iterations 30 \
    --population_size 12 \
    --num_elites 3 \
    --glycan_ccd "MAN" \
    --glycosylation_site 3 \
    --glycan_chain "C" \
    --weight-iptm 0.7 \
    --weight-plddt 0.3 \
    --convergence-window 4 \
    --max-stagnation 3 \
    --output_csv "glycopeptide_enhanced_design.csv" \
    --keep_temp_files
```

#### **å‘½ä»¤ç¤ºä¾‹ 5: ä¼ ç»Ÿæ¨¡å¼ï¼ˆå…¼å®¹æ€§ï¼‰**

å¦‚éœ€ä½¿ç”¨ä¼ ç»Ÿç®—æ³•ï¼ˆä¸æ¨èï¼Œä»…ç”¨äºå¯¹æ¯”ï¼‰ï¼š

```bash
python run_design.py \
    --yaml_template /path/to/your/template_protein.yaml \
    --binder_chain "B" \
    --binder_length 20 \
    --iterations 25 \
    --disable-enhanced \
    --output_csv "traditional_design.csv"
```

## âš™ï¸ å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

#### è¾“å…¥ä¸ç›®æ ‡å®šä¹‰

  - `--yaml_template` **(å¿…éœ€)**: æ¨¡æ¿YAMLæ–‡ä»¶çš„è·¯å¾„ã€‚
  - `--binder_chain` **(å¿…éœ€)**: å¾…è®¾è®¡è‚½é“¾çš„é“¾ID (ä¾‹å¦‚, "B")ã€‚
  - `--binder_length` **(å¿…éœ€)**: å¾…è®¾è®¡è‚½é“¾çš„é•¿åº¦ã€‚
  - `--initial_binder_sequence`: (å¯é€‰) æä¾›ä¸€ä¸ªåˆå§‹è‚½é“¾åºåˆ—ä½œä¸ºä¼˜åŒ–çš„èµ·ç‚¹ã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»éšæœºåºåˆ—å¼€å§‹ã€‚

#### æ¼”åŒ–ç®—æ³•æ§åˆ¶

  - `--iterations`: ä¼˜åŒ–å¾ªç¯ï¼ˆä»£æ•°ï¼‰çš„æ¬¡æ•°ã€‚ (é»˜è®¤: `20`)
  - `--population_size`: æ¯ä»£å¹¶è¡Œè¯„ä¼°çš„å€™é€‰æ•°é‡ã€‚ (é»˜è®¤: `8`)
  - `--num_elites`: ä¿ç•™åˆ°ä¸‹ä¸€ä»£çš„é¡¶çº§å€™é€‰ï¼ˆç²¾è‹±ï¼‰æ•°é‡ã€‚å¿…é¡»å°äº`population_size`ã€‚ (é»˜è®¤: `2`)
  - `--weight-iptm` / `--weight-plddt`: åˆ†åˆ«æ˜¯å¤åˆè¯„åˆ†å‡½æ•°ä¸­ `ipTM` å’Œ `pLDDT` çš„æƒé‡ã€‚ (é»˜è®¤: `0.7` / `0.3`)

#### å¢å¼ºåŠŸèƒ½é€‰é¡¹ ğŸš€

  - `--enable-enhanced` / `--disable-enhanced`: å¯ç”¨/ç¦ç”¨å¢å¼ºç‰ˆåŠŸèƒ½ã€‚(é»˜è®¤: å¯ç”¨)
  - `--convergence-window`: æ”¶æ•›æ£€æµ‹çš„æ»‘åŠ¨çª—å£å¤§å°ã€‚è¾ƒå°å€¼æ›´æ•æ„Ÿã€‚ (é»˜è®¤: `5`)
  - `--convergence-threshold`: æ”¶æ•›æ£€æµ‹çš„åˆ†æ•°æ–¹å·®é˜ˆå€¼ã€‚è¾ƒå°å€¼æ›´ä¸¥æ ¼ã€‚ (é»˜è®¤: `0.001`)
  - `--max-stagnation`: è§¦å‘æ—©åœçš„æœ€å¤§åœæ»å‘¨æœŸæ•°ã€‚è¾ƒå°å€¼æ›´æ¿€è¿›ã€‚ (é»˜è®¤: `3`)
  - `--initial-temperature`: è‡ªé€‚åº”çªå˜çš„åˆå§‹æ¸©åº¦ã€‚è¾ƒé«˜å€¼æ›´æ¢ç´¢æ€§ã€‚ (é»˜è®¤: `1.0`)
  - `--min-temperature`: è‡ªé€‚åº”çªå˜çš„æœ€å°æ¸©åº¦ã€‚è¾ƒé«˜å€¼ä¿æŒæ›´å¤šéšæœºæ€§ã€‚ (é»˜è®¤: `0.1`)

#### ğŸ¯ ä¼˜åŒ–æ¨¡å¼æ¨è

| æ¨¡å¼ | æ”¶æ•›çª—å£ | åœæ»é˜ˆå€¼ | åˆå§‹æ¸©åº¦ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|----------|----------|
| **å¹³ç¨³ä¼˜åŒ–** | 5 | 3 | 1.0 | æ ‡å‡†è®¾è®¡ï¼Œç¨³å®šæ”¶æ•› |
| **æ¿€è¿›æ¢ç´¢** | 3 | 2 | 2.0 | çªç ´å±€éƒ¨æœ€ä¼˜ï¼Œå¿«é€Ÿæ¢ç´¢ |
| **ç²¾ç»†è°ƒä¼˜** | 7 | 4 | 0.8 | å·²æœ‰å¥½åºåˆ—ï¼Œç²¾ç»†ä¼˜åŒ– |
| **ä¿å®ˆè®¾è®¡** | 6 | 5 | 0.5 | å¯¹ç¨³å®šæ€§è¦æ±‚é«˜çš„åœºæ™¯ |

#### ç³–è‚½è®¾è®¡ (å¯é€‰)

  - `--glycan_ccd`: æ¿€æ´»ç³–è‚½è®¾è®¡æ¨¡å¼ã€‚æä¾›èšç³–çš„3å­—æ¯PDB CCDä»£ç  (ä¾‹å¦‚, `MAN`, `NAG`, `GAL`)ã€‚ (é»˜è®¤: `None`)
  - `--glycosylation_site`: åœ¨binderåºåˆ—ä¸Šå…±ä»·è¿æ¥èšç³–çš„ä½ç½® **(1-basedç´¢å¼•)**ã€‚å¦‚æœä½¿ç”¨äº†`--glycan_ccd`ï¼Œæ­¤é¡¹ä¸º**å¿…éœ€**ã€‚
  - `--glycan_chain`: åˆ†é…ç»™èšç³–é…ä½“çš„å”¯ä¸€é“¾IDã€‚ (é»˜è®¤: `C`)

#### è¾“å‡ºä¸æ—¥å¿—

  - `--output_csv`: ä¿å­˜æ‰€æœ‰å·²è¯„ä¼°è®¾è®¡ç»“æœçš„CSVæ±‡æ€»æ–‡ä»¶çš„è·¯å¾„ã€‚ (é»˜è®¤: `design_summary_<timestamp>.csv`)
  - `--keep_temp_files`: è‹¥è®¾ç½®ï¼Œåˆ™åœ¨è¿è¡Œç»“æŸåä¸åˆ é™¤ä¸´æ—¶å·¥ä½œç›®å½•ã€‚

#### API è¿æ¥

  - `--server_url`: è¿è¡Œä¸­çš„Boltz-WebUIé¢„æµ‹APIçš„URLã€‚ (é»˜è®¤: `http://127.0.0.1:5000`)
  - `--api_token`: APIå¯†é’¥ã€‚å»ºè®®é€šè¿‡ `API_SECRET_TOKEN` ç¯å¢ƒå˜é‡è®¾ç½®ã€‚

## ğŸ“Š è¾“å‡ºè§£è¯»

ç¨‹åºè¿è¡Œç»“æŸåï¼Œä¼šç”Ÿæˆä»¥ä¸‹è¾“å‡ºï¼š

  - **æ§åˆ¶å°æ—¥å¿—**: å®æ—¶æ˜¾ç¤ºæ¼”åŒ–è¿›ç¨‹ã€æ¯ä¸€ä»£çš„æœ€ä½³åˆ†æ•°ã€è­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯ã€‚
  - **CSVæ±‡æ€»æ–‡ä»¶ (`--output_csv`)**: åŒ…å«æ‰€æœ‰å·²è¯„ä¼°åºåˆ—çš„è¯¦ç»†ä¿¡æ¯åŠå…¶è¯„åˆ†æŒ‡æ ‡ï¼ˆ`composite_score`, `ipTM`, `pLDDT` ç­‰ï¼‰ã€‚
    - ğŸ†• **æ–°å¢å­—æ®µ**: `mutation_strategy` (ä½¿ç”¨çš„çªå˜ç­–ç•¥), `is_pareto_optimal` (æ˜¯å¦ä¸ºParetoæœ€ä¼˜è§£)
    - æ–‡ä»¶å·²æŒ‰ç»¼åˆåˆ†æ•°ä»é«˜åˆ°ä½æ’åºã€‚
  - **ä¸´æ—¶æ–‡ä»¶ (`--keep_temp_files`)**: å¦‚æœé€‰æ‹©ä¿ç•™ï¼Œå·¥ä½œç›®å½•ä¸­å°†åŒ…å«æ¯æ¬¡APIè°ƒç”¨çš„è¾“å…¥ï¼ˆYAMLï¼‰ã€è¾“å‡ºï¼ˆPDB/CIFï¼‰å’Œç½®ä¿¡åº¦æ–‡ä»¶ï¼Œå¯ç”¨äºåç»­åˆ†ææˆ–è°ƒè¯•ã€‚

### ğŸ“ˆ æ€§èƒ½ç›‘æ§

å¢å¼ºç‰ˆæä¾›æ›´ä¸°å¯Œçš„è¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼š

```
[INFO] Generation 5 complete. Best score: 0.8542 (ipTM: 0.8901, pLDDT: 78.43)
[INFO] Enhanced features enabled with custom parameters
[DEBUG] Strategy success rates: conservative=0.75, aggressive=0.32, motif_guided=0.68
[DEBUG] Population diversity - similarity: 0.423, entropy: 2.87
[INFO] Convergence detected: score variance 0.0008 < threshold 0.001
[INFO] Early stopping triggered after 3 stagnation cycles
```